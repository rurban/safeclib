<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>safec: Safe C Library - README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">safec<span id="projectnumber">&#160;3.7.0</span>
   </div>
   <div id="projectbrief">Safe C Library - ISO TR24731 Bounds Checking Interface</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Safe C Library - README </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__r_e_a_d_m_e"></a></p>
<p><a href="https://github.com/rurban/safeclib/issues"><img src="doc/safeclib-banner.png" alt="safeclib" class="inline"/></a></p>
<h1><a class="anchor" id="autotoc_md0"></a>
Copying</h1>
<p>This project's licensing restrictions are documented in the file 'COPYING' under the root directory of this release. Basically it's MIT licensed.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Overview</h1>
<p>This library implements the secure C11 Annex K[^5] functions on top of most libc implementations, which are missing from them.</p>
<p>The ISO TR24731 Bounds Checking Interface documents indicate that the key motivation for the new specification is to help mitigate the ever increasing security attacks, specifically the buffer overrun.[^1]</p>
<p>The rationale document says _"Buffer overrun attacks continue to be a security
problem. Roughly 10% of vulnerability reports cataloged by CERT from
01/01/2005 to 07/01/2005 involved buffer overflows. Preventing buffer overruns
is the primary, but not the only, motivation for this technical report."_[^2]</p>
<p>The rationale document continues _"that these only mitigate, that is lessen,
security problems. When used properly, these functions decrease the danger
buffer overrun attacks. Source code may remain vulnerable due to other bugs
and security issues. The highest level of security is achieved by building in
layers of security utilizing multiple strategies."_[^2]</p>
<p>The rationale document lists the following key points for TR24731:</p>
<ul>
<li>Guard against overflowing a buffer</li>
<li>Do not produce unterminated strings</li>
<li>Do not unexpectedly truncate strings</li>
<li>Provide a library useful to existing code</li>
<li>Preserve the zero terminated string datatype</li>
<li>Only require local edits to programs</li>
<li>Library based solution</li>
<li>Support compile-time checking</li>
<li>Make failures obvious</li>
<li>Zero buffers, null strings</li>
<li>Runtime-constraint handler mechanism</li>
<li>Support re-entrant code</li>
<li>Consistent naming scheme</li>
<li>Have a uniform pattern for the function parameters and return type</li>
<li>Deference to existing technology</li>
</ul>
<p>and the following can be added...</p>
<ul>
<li>provide a library of functions with like behavior</li>
<li>provide a library of functions that promote and increase code safety and security</li>
<li>provide a library of functions that are efficient</li>
</ul>
<p>The C11 Standard adopted many of these points, and added some secure <code>_s</code> variants in the Annex K. The Microsoft Windows/MINGW secure API did the same, but deviated in some functions from the standard. Besides Windows (with its msvcrt, ucrt, reactos msvcrt and wine msvcrt variants) only the unused stlport, Android's Bionic, Huawei securec and Embarcadero implemented this C11 secure Annex K API so far. They are still missing from glibc, musl, FreeBSD, darwin and DragonFly libc, OpenBSD libc, newlib, dietlibc, uClibc, minilibc.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Design Considerations</h1>
<p>This library implements since 3.0 all functions defined in the specifications.[^3] Included in the library are extensions to the specification to provide a complementary set of functions with like behavior.</p>
<p>This library is meant to be used on top of all the existing libc's which miss the secure C11 functions. Of course tighter integration into the system libc would be better, esp. with the printf, scanf and IO functions. See the seperate <a class="el" href="d6/d31/md_doc_2libc-overview.html">libc-overview</a> document.</p>
<p>Austin Group Review of ISO/IEC WDTR 24731 <a href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1106.txt">http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1106.txt</a></p>
<p>C11 standard (ISO/IEC 9899:2011) <a href="http://en.cppreference.com/w/c">http://en.cppreference.com/w/c</a></p>
<p>CERT C Secure Coding Standard[^4]</p>
<p>Stackoverflow discussion: <a href="https://stackoverflow.com/questions/372980/do-you-use-the-tr-24731-safe-functions">https://stackoverflow.com/questions/372980/do-you-use-the-tr-24731-safe-functions</a></p>
<p>DrDobbs review[^6] <a href="http://www.drdobbs.com/cpp/the-new-c-standard-explored/232901670">http://www.drdobbs.com/cpp/the-new-c-standard-explored/232901670</a></p>
<p>C17 reconsidered safeclib but looked only at the old incomplete Cisco version, not our complete and fixed version. <a href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1967.htm">http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1967.htm</a></p>
<ul>
<li>Use of errno</li>
</ul>
<p>The TR24731 specification says an implementation may set errno for the functions deÔ¨Åned in the technical report, but is not required to. This library does not set <code>errno</code> in most functions, only in <code>bsearch_s</code>, <code>fscanf_s</code>, <code>fwscanf_s</code>, <code>gets_s</code>, <code>gmtime_s</code>, <code>localtime_s</code>, <code>scanf_s</code>, <code>sscanf_s</code>, <code>swscanf_s</code>, <code>strtok_s</code>, <code>vfscanf_s</code>, <code>vfwscanf_s</code>, <code>vsscanf_s</code>, <code>vswscanf_s</code>, <code>wcstok_s</code>, <code>wscanf_s</code>.</p>
<p>In most cases the safeclib extended ES* errors do not set <code>errno</code>, only when the underlying insecure system call fails, errno is set. The library does use <code>errno</code> return codes as required by functional APIs. Specific Safe C String and Safe C Memory errno codes are defined in the <code>safe_errno.h</code> file.</p>
<ul>
<li>Runtime-constraints</li>
</ul>
<p>Per the spec, the library verifies that the calling program does not violate the function's runtime-constraints. If a runtime-constraint is violated, the library calls the currently registered runtime-constraint handler.</p>
<p>Per the spec, multiple runtime-constraint violations in the same call to a library function result in only one call to the runtime-constraint handler. The first violation encountered invokes the runtime-constraint handler.</p>
<p>With <code>--disable-constraint-handler</code> calling the runtime-constraint handler can be disabled, saving some memory, but not much run-time performance.</p>
<p>With <code>--with-default-handler=&lt;abort|ignore&gt;</code> you may set the default constraint handler at compile-time to <code>abort_handler_s</code> or <code>ignore_handler_s</code>.</p>
<p>The runtime-constraint handler might not return. If the handler does return, the library function whose runtime-constraint was violated returns an indication of failure as given by the function‚Äôs return. With valid dest and dmax values, dest is cleared. With the optional <code>--disable-null-slack</code> only the first value of dest is cleared, otherwise the whole dest buffer.</p>
<p><code>rsize_t</code> The specification defines a new type. This type, <code>rsize_t</code>, is conditionally defined in the <code><a class="el" href="db/d69/safe__lib_8h.html">safe_lib.h</a></code> header file.</p>
<p><code>RSIZE_MAX</code> The specification defines the macro <code>RSIZE_MAX</code> which expands to a value of type <code>rsize_t</code>. The specification uses <code>RSIZE_MAX</code> for both the string functions and the memory functions. This implementation defines two macros: <code>RSIZE_MAX_STR</code> and <code>RSIZE_MAX_MEM</code>. <code>RSIZE_MAX_STR</code> defines the range limit for the safe string functions. <code>RSIZE_MAX_MEM</code> defines the range limit for the safe memory functions. The point is that string limits can and should be different from memory limits. There also exist <code>RSIZE_MAX_WSTR</code>, <code>RSIZE_MAX_MEM16</code>, <code>RSIZE_MAX_MEM32</code>.</p>
<ul>
<li>Compile-time constraints</li>
</ul>
<p>With supporting compilers the dmax overflow checks and several more are performed at compile-time. Currently only since clang-5 with <code>diagnose_if</code> support. This checks similar to <code>_FORTIFY_SOURCE=2</code> if the <code>__builtin_object_size</code> of the dest buffer is the same size as dmax, and errors if dmax is too big. With the optional <code>--enable-warn-dmax</code> it prints a warning if the sizes are different, which is esp. practical as compile-time warning. It can be promoted via the optional <code>--enable-error-dmax</code> to be fatal. On unsupported compilers, the overflow check and optional equality warn-dmax check is deferred to run-time. This check is only possible with <code>__builtin_object_size</code> and <code>-O2</code> when the dest buffer size is known at compile-time, otherwise only the simplier <code>dest == NULL</code>, <code>dmax == 0</code> and <code>dmax &gt; RSIZE_MAX</code> checks are performed.</p>
<ul>
<li>Header Files</li>
</ul>
<p>The specification states the various functions would be added to existing Standard C header files: stdio.h, string.h, etc. This implementation separates the memory related functions into the <code><a class="el" href="d8/d03/safe__mem__lib_8h.html">safe_mem_lib.h</a></code> header, the string related functions into the <code><a class="el" href="d8/dff/safe__str__lib_8h.html">safe_str_lib.h</a></code> header, and the rest into the <code><a class="el" href="db/d69/safe__lib_8h.html">safe_lib.h</a></code> header. There are also the internal <code><a class="el" href="df/d0a/safe__compile_8h.html">safe_compile.h</a></code>, <code><a class="el" href="d3/ddb/safe__config_8h.html">safe_config.h</a></code> <code><a class="el" href="d0/dc2/safe__lib__errno_8h.html">safe_lib_errno.h</a></code> and <code><a class="el" href="dd/d0a/safe__types_8h.html">safe_types.h</a></code> headers, but they do not need to be included. You can also include all safec API's with <code>&lt;<a class="el" href="d2/d43/safec_8h.html">safec.h</a>&gt;</code>.</p>
<p>The make file builds a single library <code>libsafec-VERSION.a</code> and <code>.so</code>. Built but not installed are also libmemprims, libsafeccore and libstdunsafe.</p>
<p>It is possible to split the make such that a separate <code>safe_mem_lib.so</code> and <code>safe_str_lib.so</code> are built. It is also possible to integrate the prototypes into the Standard C header files, but that may require changes to your development tool chain.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Userspace Library</h1>
<p>The build system for the userspace library is the well known <em>GNU build system</em>, a.k.a. Autotools. This system is well understood and supported by many different platforms and distributions which should allow this library to be built on a wide variety of platforms. See the Tested platforms section for details on what platforms this library was tested on during its development.</p>
<ul>
<li>Building</li>
</ul>
<p>For those familiar with autotools you can probably skip this part. For those not and want to get right to building the code see below. And, for those that need additional information see the <code>INSTALL</code> file in the same directory.</p>
<p>To build you do the following: </p><pre class="fragment">./build-aux/autogen.sh
./configure
make
</pre><p> <code>autogen.sh</code> only needs to be run if you are building from the git repository. Optionally, you can do <code>make check</code> if you want to run the unit tests.</p>
<p>On Apple M1-M3 hardware I was told to use this: </p><pre class="fragment">./configure --disable-hardening CC="clang -arch arm64 -arch x86_64" \
  CXX="clang -arch arm64 -arch x86_64" CPP="clang -E" CXXCPP="clang -E"
</pre><p> This builds safeclib as a fat lib for macOS arm64 + X86-64 using clang.</p>
<ul>
<li>Installing</li>
</ul>
<p>Installation must be preformed by <code>root</code>, an <code>Administrator</code> on most systems. The following is used to install the library. </p><pre class="fragment">sudo make install
</pre> <h1><a class="anchor" id="autotoc_md4"></a>
Safe Linux Kernel Module</h1>
<p>The build for the kernel module has not been integrated into the autotools build infrastructure. Consequently, you have to run a different makefile to build the kernel module.</p>
<ul>
<li>Building</li>
</ul>
<p>.To build do the following: </p><pre class="fragment">./configure --disable-wchar
make -f Makefile.kernel
</pre><p> This assumes you are compiling on a Linux box and this makefile supports the standard kernel build system infrastructure documented in: <code>/usr/src/linux-kernel/Documentation/kbuild/modules.txt</code></p>
<p>NOTE: If you build the kernel module then wish to build the userspace library or vice versa you will need to do a <code>make clean</code> otherwise a <code>make check</code> will fail to build.</p>
<ul>
<li>Installing</li>
</ul>
<p>The kernel module will be found at the root of the source tree called <code>slkm.ko</code>. The file <code>testslkm.ko</code> are the unit tests run on the userspace library but in Linux kernel module form to verify functionality within the kernel.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Tested Platforms</h1>
<p>The library has been tested on the following systems:</p>
<ul>
<li>Linux Fedora core 31 - 36 amd64/i386 glibc 2.28 - 2.36 (all gcc's + clang's)</li>
<li>Mac OS X 10.6-12 w/ Apple developer tools and macports (all gcc's + clang's)</li>
<li>Linux Debian 9 - 11 amd64/i386 glibc 2.24 - 2.28 (all gcc's + clang's)</li>
<li>Linux centos 7 amd64</li>
<li>Linux Void amd64 musl-1.1.16</li>
<li>x86_64-w64-mingw32 native and cross-compiled</li>
<li>i686-w64-mingw32 native, and cross-compiled and tested under wine</li>
<li>i386-mingw32 cross-compiled</li>
<li>cygwin32 gcc (newlib)</li>
<li>cygwin64 gcc -std=c99 (newlib)</li>
<li>freebsd 10 - 13 amd64</li>
<li>linux docker images under qemu: i386/debian, x86_64/rhel, arm32v7/debian, aarch64: arm64v8/{debian,centos,rhel,fedora}, s390x/fedora (the only big endian test I could find), ppc64le/{debian,ubuntu,fedora,centos,rhel}</li>
<li>User Mode Linux (UML), Linux kernel version v3.5.3 w/ Debian Squeeze rootfs</li>
</ul>
<p>with most available compilers. See <code>build-aux/smoke.sh</code> and the various CI configs.</p>
<ul>
<li><a href="https://travis-ci.org/github/rurban/safeclib/">https://travis-ci.org/github/rurban/safeclib/</a></li>
<li><a href="https://ci.appveyor.com/project/rurban/safeclib/">https://ci.appveyor.com/project/rurban/safeclib/</a></li>
<li><a href="https://cirrus-ci.com/github/rurban/safeclib">https://cirrus-ci.com/github/rurban/safeclib</a></li>
<li><a href="https://cloud.drone.io/rurban/safeclib/">https://cloud.drone.io/rurban/safeclib/</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md6"></a>
Known Issues</h1>
<ol type="1">
<li>If you are building the library from the git repository you will have to first run <code>build-aux/autogen.sh</code> which runs autoreconf to <code>install</code> the autotools files and create the configure script.</li>
<li>If you use cmake, you'd need to add <code>-DCMAKE_APPLE_SILICON_PROCESSOR=$(uname -m)</code> for Apple Silicon M1 or M2 processors.</li>
</ol>
<h1><a class="anchor" id="autotoc_md7"></a>
References</h1>
<p>[^1]: Programming languages, their environments and system software interfaces, Extensions to the C Library, Part I: Bounds-checking interfaces, ISO/IEC TR 24731-1.</p>
<p>[^2]: Rationale for TR 24731 Extensions to the C Library Part I: Bounds-checking interfaces, ISO/IEC JTC1 SC22 WG14 N1225.</p>
<p>[^3]: The Open Group Base Specifications Issue 7 <a href="http://pubs.opengroup.org/onlinepubs/9699919799/functions/contents.html">http://pubs.opengroup.org/onlinepubs/9699919799/functions/contents.html</a></p>
<p>[^4]: CERT C Secure Coding Standard <a href="https://www.securecoding.cert.org/confluence/display/seccode/CERT+C+Secure+Coding+Standard">https://www.securecoding.cert.org/confluence/display/seccode/CERT+C+Secure+Coding+Standard</a></p>
<p>[^5]: C11 Standard (ISO/IEC 9899:2011) Annex K</p>
<p>[^6]: DrDobbs review <a href="http://www.drdobbs.com/cpp/the-new-c-standard-explored/232901670">http://www.drdobbs.com/cpp/the-new-c-standard-explored/232901670</a> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<hr class="footer"/><address class="footer"><small>
Generated for Safe C Library 01022022.43-g5fd164 3.7.0
by <a href="http://www.doxygen.org/index.html">doxygen</a>
</small></address></body></html>
